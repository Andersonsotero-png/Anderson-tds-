<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parquinho App - Terra do Sol</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#00B3AA" />
  <link rel="stylesheet" href="css/style.css" />

  <!-- Bibliotecas: QRCode + jsQR + SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- üî• FIREBASE MODO NORMAL (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- üî• Seus arquivos Firebase -->
  <script src="firebase-config.js"></script>
  <script src="firebase-sync.js"></script>
</head>

<body>
  <header>
    <div class="brand">
      <img alt="logo" id="appLogo" src="assets/icons/icon-512.png" />
      <h1 id="appTitle">Parquinho App - Terra do Sol</h1>
    </div>
    <nav>
      <button data-tab="cadastro" class="active">Cadastro</button>
      <button data-tab="busca">Busca</button>
      <button data-tab="historico">Historico</button>
      <button data-tab="marketing">Marketing</button>
      <button data-tab="impressao">Impress√£o</button>
    </nav>
  </header>

  <main>
    <!-- =====================
         üîµ  ABA: CADASTRO
    ====================== -->
    <section id="cadastro" class="tab active">
      <form id="formCadastro" autocomplete="off">

        <label>Tipo de ingresso / pulseira:
          <select name="tipoIngresso" id="tipoIngresso" required>
            <option value="inteira">Inteira ‚Äî R$ 35,90</option>
            <option value="meia">Meia ‚Äî R$ 17,95 (PCD / TEA / Down)</option>
            <option value="cortesia">Cortesia ‚Äî R$ 0,00</option>
          </select>
        </label>

        <div id="meiaMotivoWrapper" style="display:none">
          <label>Motivo da meia:
            <select name="meiaMotivo" id="meiaMotivo">
              <option value="">Selecione</option>
              <option value="pcd">PCD</option>
              <option value="tea">TEA</option>
              <option value="down">Down</option>
            </select>
          </label>
        </div>

        <label>Nome completo (crian√ßa):
          <input type="text" name="nome" required />
        </label>

        <label>Data de nascimento:
          <input type="date" name="dataNascimento" required />
        </label>

        <label>Idade:
          <input type="number" name="idade" readonly />
        </label>

        <label>Nome do respons√°vel:
          <input type="text" name="responsavel" />
        </label>

        <label>Telefone do respons√°vel:
          <input type="tel" name="telefone" placeholder="+55..." />
        </label>

        <label>Email:
          <input type="email" name="email" />
        </label>

        <label>Setor da barraca:
          <select name="setor">
            <option value="sal√£o">Sal√£o</option>
            <option value="coqueiro">Coqueiro</option>
            <option value="guarda-sol">Guarda-sol</option>
          </select>
        </label>

        <label>Mesa:
          <input type="text" name="mesa" />
        </label>

        <label>Possui alergia?
          <select name="temAlergia" id="temAlergia">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </label>

        <label id="alergiaLabel" style="display:none">Qual alergia?
          <input type="text" name="qualAlergia" />
        </label>

        <label>Altura:
          <select name="altura" id="alturaSelect">
            <option value="menor">Menor que 1 metro</option>
            <option value="maior">Maior que 1 metro</option>
          </select>
        </label>

        <label>Sai sozinho?
          <select name="saiSozinho" id="saiSozinhoSelect">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </label>

        <div style="margin-top:8px">
          <span id="liveBadge" class="badge red">N√ÉO SAI SOZINHO</span>
        </div>

        <label>Observa√ß√µes:
          <textarea name="observacoes"></textarea>
        </label>

        <div class="row">
          <button type="submit" id="btnCadastrar">Cadastrar</button>
          <button type="button" id="btnGerarTodosQR">Gerar QR de todos</button>
        </div>
      </form>

      <div id="resultCadastro" class="card">
        <h3>√öltimo QR gerado</h3>
        <div id="qrCodeCadastro"></div>
        <div class="row">
          <button id="btnDownloadQR">Baixar QR</button>
          <button id="btnPrintLabel">Imprimir etiqueta</button>
          <button id="btnPrintLabelSmall">Etiqueta pequena</button>
        </div>
      </div>

      <hr />

      <div id="cameraControls" class="card">
        <h3>Leitor de QR (C√¢mera)</h3>
        <div class="row">
          <button id="btnStartCamera">Abrir c√¢mera</button>
          <button id="btnStopCamera" disabled>Fechar c√¢mera</button>
          <button id="btnScanNow" disabled>Registrar Entrada/Sa√≠da</button>
          <button id="btnRegistrarManual">Registrar Manual</button>
        </div>

        <div id="videoWrap">
          <video id="video" autoplay playsinline></video>
          <canvas id="scanCanvas" hidden></canvas>
        </div>

        <div id="scanMessage"></div>
      </div>
    </section>

    <!-- =====================
         üîµ  ABA BUSCA
    ====================== -->
    <section id="busca" class="tab">
      <input type="text" id="inputBusca" placeholder="Buscar por nome, mesa, tel..." />
      <ul id="listaBusca"></ul>
    </section>

    <!-- =====================
         üîµ  HIST√ìRICO
    ====================== -->
    <section id="historico" class="tab">
      <h2>Hist√≥rico de Cadastros</h2>
      <div class="card">
        <label>Filtrar hist√≥rico:
          <div class="row">
            <input type="date" id="histFrom" />
            <input type="date" id="histTo" />
            <button id="btnFilterHistorico">Aplicar</button>
            <button id="btnResetHistorico">Limpar</button>
          </div>
        </label>
      </div>
      <div id="listaHistoricoContainer"></div>

      <div class="row">
        <button id="btnExportJSON">Exportar Excel</button>
        <button id="btnLimparTudo">Limpar tudo</button>
      </div>
    </section>

    <!-- =====================
         üîµ MARKETING
    ====================== -->
    <section id="marketing" class="tab">
      <h2>Marketing & Contatos</h2>

      <div class="card">
        <h4>Mensagem / Promo√ß√£o</h4>
        <textarea id="marketingMessage"></textarea>

        <label>Anexar imagem:
          <input type="file" id="marketingImage" accept="image/*" />
        </label>

        <div id="marketingImagePreview" style="display:none; margin-top:10px; position:relative;">
          <img id="marketingPreviewImg" style="max-width:180px;border-radius:8px;border:1px solid #ddd" />
          <button id="marketingRemoveImg" style="position:absolute;top:-8px;right:-8px;background:#e74c3c;color:white;border:none;border-radius:50%;width:26px;height:26px;font-weight:700">√ó</button>
        </div>

        <div class="row">
          <button id="btnSelectAll">Selecionar todos</button>
          <button id="btnClearAll">Limpar</button>
          <button id="btnSaveSelectedVCF">Salvar selecionados (.vcf)</button>
          <button id="btnSaveAllVCF" class="secondary">Salvar todos (.vcf)</button>
          <button id="btnSendToSelected">Enviar</button>
        </div>
      </div>

      <div class="card">
        <h4>Lista de clientes</h4>
        <div id="marketingList"></div>
      </div>
    </section>

    <!-- =====================
         üîµ IMPRESS√ÉO
    ====================== -->
    <section id="impressao" class="tab">
      <h2>Impress√£o</h2>

      <div class="card">
        <div class="row">
          <label>Filtro r√°pido:
            <select id="quickFilter">
              <option value="hoje">Hoje</option>
              <option value="ontem">Ontem</option>
              <option value="ult7">√öltimos 7 dias</option>
              <option value="mesAtual">M√™s atual</option>
              <option value="intervalo">Intervalo...</option>
            </select>
          </label>

          <label>In√≠cio:
            <input type="date" id="filterFrom" />
          </label>

          <label>Fim:
            <input type="date" id="filterTo" />
          </label>

          <button id="btnFiltrar">Filtrar</button>
          <button id="btnImprimirFiltro">Imprimir</button>
          <button id="btnVoltarImpressao" type="button" style="background:#555">Voltar</button>
        </div>

        <label style="margin-top:10px">
          Observa√ß√µes / ocorr√™ncias:
          <textarea id="impressaoObservacoes"></textarea>
        </label>
      </div>

      <div id="relatorioPreview" class="card"></div>
      <div id="faturamentoResumo" class="card" style="margin-top:10px"></div>
    </section>

  </main>

  <!-- üîµ JavaScript principal -->
  <script src="js/script.js"></script>
</body>
</html>
